<% layout('layouts/boilerplate')%>
<div class="col-md-12 mb-3">
  <div class="row row-cols-1 row-cols-sm-1 row-cols-md-1 g-3 d-flex justify-content-center">
    <div class="col-md-8">
      <div class="card mb-3 small">
        <div class="card-header d-flex justify-content-between">
          <div class="flex-shrink-0 dropdown">
            <% if (serviceProvider.serviceProviderType === 'Organization') { %> <i class="bi bi-buildings-fill"></i> <% } else { %> <i class="bi bi-person-fill"></i> <% } %>
            <p class="d-inline fw-400"><%= serviceProvider.serviceProviderType %></p>
          </div>

          <div class="d-flex jusity-content-center align-items-center">
            <!-- <a class="" data-bs-toggle="collapse" data-bs-target="#collapseExample_<%= serviceProvider._id %>" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">
              <i class="bi bi-three-dots"></i>
            </a> -->

            <div class="d-flex jusity-content-center align-items-center" style="cursor: pointer">
              <!-- <a id="saveWatchlistServicesBtn" href="#" data-serviceid="<%= serviceProvider._id%>" style="font-size: 1.2rem; cursor: pointer">
                <i class="bi bi-bookmark-star"></i>
              </a> -->
              <a class="text-secondary" id="saveWatchlistServicesBtn" data-serviceid="<%= serviceProvider._id%>" style="font-size: 1.2rem; cursor: pointer">
                <% if (currentUser && serviceProvider._id && currentUser.favorites.length > 0 && currentUser.favorites.includes(serviceProvider._id)) { %>
                <i class="bi bi-bookmark-heart-fill" style="pointer-events: none"></i>
                <% } else { %>
                <i class="bi bi-bookmark-heart" style="pointer-events: none"></i>
                <% } %></a
              >
            </div>

            <!-- <div data-servicecoords="<%=serviceProvider.location.coordinates %>" class="d-flex jusity-content-center align-items-center geoButtonZoom" style="cursor: pointer">
              <a href="#" style="font-size: 1.2rem; pointer-events: none"><i style="pointer-events: none" class="bi bi-geo-alt-fill"></i></a>
            </div> -->
          </div>
        </div>
        <div class="card-body">
          <div class="col-md-12">
            <div class="d-flex justify-content-center">
              <% if (serviceProvider.logo[0].url) { %>

              <img src="<%= serviceProvider.logo[0].url %>" alt="mdo" width="100" height="100" class="rounded-circle me-2" />

              <% } else { %>
              <img src="/images/icons/user.png" alt="mdo" width="100" height="100" class="rounded-circle me-2" />
              <% } %>
            </div>

            <div class="col p-4 d-flex flex-column position-static">
              <h3 class="mb-0 text-center"><%= serviceProvider.name %></h3>
              <!-- <div class="mb-1 text-body-secondary">Nov 11</div> -->
              <p class="mb-auto" style="text-align: justify"><%= serviceProvider.description %></p>

              <!-- <a href="#" class="icon-link gap-1 icon-link-hover stretched-link">
                
                <svg class="bi"><use xlink:href="#chevron-right"></use></svg>
              </a> -->
              <div class="mt-3">
                <ul class="list-group list-group-flush show-pet-list">
                  <p>Contacts:</p>
                  <div class="row ms-3">
                    <div class="col-12 col-md-12 col-lg-12 mb-1">
                      <b><i class="bi bi-telephone-fill"></i> Phone: </b>
                      <a href="tel:<%=serviceProvider.phonecode%><%=serviceProvider.phone%>"><%=serviceProvider.phonecode%><%=serviceProvider.phone%></a>
                    </div>

                    <div class="col-12 col-md-12 col-lg-12 mb-1">
                      <b><i class="bi bi-envelope-fill"></i> Email: </b>
                      <a href="mailto:<%= serviceProvider.email %>?subject=Hello%20World&body=I%20hope%20you%20are%20doing%20well."><%= serviceProvider.email %></a>
                    </div>

                    <div class="col-12 col-md-12 col-lg-12 mb-1">
                      <b><i class="bi bi-facebook"></i> Facebook: </b>
                      <a target="_blank" href="https://www.facebook.com/<%=serviceProvider.socialMedia.facebook%>"><%= serviceProvider.socialMedia.facebook %></a>
                    </div>

                    <div class="col-12 col-md-12 col-lg-12 mb-1">
                      <b><i class="bi bi-instagram"></i> Instagram: </b>
                      <a target="_blank" href="https://www.instagram.com/<%=serviceProvider.socialMedia.instagram%>"><%= serviceProvider.socialMedia.instagram %></a>
                    </div>
                    <div class="col-12 col-md-12 col-lg-12 mb-1">
                      <b><i class="bi bi-globe2"></i> Website: </b>
                      <a href="<%= serviceProvider.website %>" target="_blank"><%= serviceProvider.website %></a>
                    </div>
                  </div>
                  <!-- <div class="card card-body">
                    <p class="card-text"><%= serviceProvider.description %></p>
                  </div> -->
                </ul>
              </div>
            </div>
          </div>

          <!-- <div class="collapse" id="collapseExample_<= serviceProvider._id %>">
            <div class="card card-body">
              <p class="card-text"><= serviceProvider.description %></p>
            </div>
          </div> -->
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const saveFavorites = async (favoritesData) => {
    try {
      const response = await fetch('/user/favorites', {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(favoritesData),
      });

      if (response.ok) {
        // Watchlist updated successfully
        console.log('Watchlist updated successfully');
      } else {
        throw new Error('Failed to update watchlist');
      }
    } catch (error) {
      console.error(error);
      // Handle error and display appropriate message
    }
  };

  const saveWatchlistServicesBtn = document.querySelector('#saveWatchlistServicesBtn');

  saveWatchlistServicesBtn.addEventListener('click', async (e) => {
    // Retrieve the selected pets from the UI
    const serviceId = e.currentTarget.getAttribute('data-serviceid');
    const selectedService = serviceId; /* Code to retrieve the selected pets from the UI */
    console.log('selectedService', selectedService);
    // Prepare the watchlist data to send in the request body
    const favoritesData = {
      service: selectedService,
    };
    console.log('favoritesData: ', favoritesData);

    await saveFavorites(favoritesData);
    location.reload();
  });
</script>
